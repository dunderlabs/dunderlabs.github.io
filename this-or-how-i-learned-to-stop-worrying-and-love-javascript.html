<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <meta name="description" content="
    4 amigos com gostos igualmente parecidos e diferentes, reunindo
    conhecimento, experiências e muitas dúvidas sobre: Front-End,
    Python/Django, Linux, JS e etc. Devolvemos à comunidade o que em muitos
    momentos ela nos ofereceu.
">
    <meta name="keywords" content="pug-pi, python, parnaiba, desenvolvimento, web, django"/>
    <meta name="generator" content="Feito com Pure, Pelican, Python e Sublime. ">

    <!-- OpenGraph -->
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="this or: How I Learned to Stop Worrying and Love JavaScript"/>
    <meta property="og:url" content="https://dunderlabs.github.io/this-or-how-i-learned-to-stop-worrying-and-love-javascript.html"/>
    <meta property="og:site_name" content="__labs__"/>
    <meta property="og:description" content="JavaScript é uma linguagem legal, flexível e apaixonante, porém tem seus cantos obscuros que faz muita gente penar pra entender. Um desses cantos ..."/>
    <meta property="og:image" content="https://dunderlabs.github.io/images/logo1.jpg"/>

    <!-- Twitter -->
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@dunderlabs"/>
    <meta name="twitter:creator" content="@niltoncsr"/>
    <meta name="twitter:domain" content="dunderlabs.github.io"/>
    <meta name="twitter:title" content="this or: How I Learned to Stop Worrying and Love JavaScript"/>
    <meta name="twitter:description" content="JavaScript é uma linguagem legal, flexível e apaixonante, porém tem seus cantos obscuros que faz muita gente penar pra entender. Um desses cantos ..."/>
    <meta name="twitter:image:src" content="https://dunderlabs.github.io/images/logo1.jpg"/>

    <!-- Article meta -->
    <meta property="article:author" content="Nilton Cesar"/>
    <meta property="article:section" content="javascript"/>
    <meta property="article:tag" content="javascript, lexical scope, dynamic scope, arrow function"/>
    <meta property="article:published_time" content="2017-03-03T15:00:00-03:00"/>

    <!-- Google+ -->
    <meta itemprop="name" content="this or: How I Learned to Stop Worrying and Love JavaScript"/>
    <meta itemprop="description" content="JavaScript é uma linguagem legal, flexível e apaixonante, porém tem seus cantos obscuros que faz muita gente penar pra entender. Um desses cantos ..."/>
    <meta itemprop="image" content="https://dunderlabs.github.io/images/logo1.jpg"/>

    <!-- General purpose meta -->
    <meta name="description" content="JavaScript é uma linguagem legal, flexível e apaixonante, porém tem seus cantos obscuros que faz muita gente penar pra entender. Um desses cantos ..."/>
    <meta name="keywords" content="javascript, lexical scope, dynamic scope, arrow function"/>

    <!-- FEED STUFFS  -->
        <link rel="alternate"  href="https://dunderlabs.github.io/feeds/all.atom.xml" type="application/atom+xml" title="__labs__ Full Atom Feed"/>
    <!-- END FEED STUFFS  -->

        <title>this or: How I Learned to Stop Worrying and Love JavaScript // __labs__</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://dunderlabs.github.io/theme/css/pure.css">
    <link rel="stylesheet" href="https://dunderlabs.github.io/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <a href="https://dunderlabs.github.io/author/nilton-cesar.html" title="See posts by Nilton Cesar">
                        <img class="avatar" alt="Nilton Cesar" src="https://www.gravatar.com/avatar/e1f8672236bde4309ecfa8cebf6b1e6a">
                </a>
                <h2 class="article-info">Nilton Cesar</h2>
                <small class="about-author"></small>
                <h5>Publicado</h5>
                <p>Fri 03 March 2017</p>
                <a href="/">&larr; Home</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>this or: How I Learned to Stop Worrying and Love JavaScript</h1>
                        <p class="post-meta">
                            // tags                                 <a class="post-category" href="https://dunderlabs.github.io/tag/javascript.html">javascript</a>
                                <a class="post-category" href="https://dunderlabs.github.io/tag/lexical-scope.html">lexical scope</a>
                                <a class="post-category" href="https://dunderlabs.github.io/tag/dynamic-scope.html">dynamic scope</a>
                                <a class="post-category" href="https://dunderlabs.github.io/tag/arrow-function.html">arrow function</a>
                        </p>
                </header>
            </section>
            <p>Vou tentar fazer uma rápida porém merecida explicação sobre o uso do <code>this</code> na execução de funções, tópico que tira a paciência de muita gente que tá começando na linguagem ou vem ~viciado de libs e frameworks.
Os exemplos aqui são executados no browser, mas podem ser executados no Node sem problema algum, mudando só o objeto <code>window</code> para <code>global</code>.</p>
<h2>O que é <em>isto</em>?</h2>
<p>Bom, você deve tentar adivinhar pela tradução que <code>this</code> se refere a "isto". Não está totalmente errado, o ponto chave é o que é o "isto". Tente executar o <code>this</code> no console, só ele e nada mais, e você vai receber o objeto <code>window</code>. Esses são os objetos que, nos seus ambientes, guardam as referências pros outros objetos, funções, classes, etc, definidos pelo desenvolvedor. Ou seja, quando você define e atribui <code>var a = 7</code> fora de escopo de funções ou fora de objetos, na verdade é criada uma referência para essa variável em <code>window</code>, significando que dá pra acessar essa mesma variável tanto fazendo <code>a</code> como <code>window.a</code>.
Ok, mas e se eu definir uma função assim</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">outerScope</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>


<p>quando eu chamá-la eu vou rebecer a própria função? (??) Não.</p>
<p>Quando você chama <code>outerScope()</code> na verdade é a mesma coisa de estar chamando <code>window.outerScope()</code> e o <code>this</code> vai mostrar <code>window</code>. O que acontece é que o <code>this</code> se refere justamente ao contexto de invocação, ou seja, como e onde ela é <em>chamada</em>. No exemplo, quem está chamando a função <code>outerScope</code> implicitamente é o objeto <code>window</code>.</p>
<h2><code>this</code> em métodos</h2>
<p>Ainda no mesmo ambiente, suponha que você agora defina um objeto <code>o</code> assim:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">m</span><span class="o">:</span> <span class="nx">outerScope</span>
<span class="p">};</span>
</pre></div>


<p>A chave <code>m</code> tem como valor a função definida anteriormente, o que faz com que <code>m</code> seja um método do objeto <code>o</code>. Pra executar, basta <code>o.m()</code>.</p>
<p>TCHARAN! O que foi mostrado foi o próprio objeto <code>o</code>, porque agora ele é quem executa essa função que agora foi atribuída a ele.</p>
<p>Percebe como nesse caso, mesmo a função sendo definida fora do objeto, quando é atribuída e trazida pra dentro do objeto,e a partir daí não tem mais relação com o que acontece externamente com a função, o <code>this</code> muda? ;)</p>
<p>O mesmo comportamento acontece se tratando de eventos:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#submit-form&#39;</span><span class="p">);</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
    <span class="s1">&#39;click&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<p>No código acima, atribuímos um elemento HTML à variável <code>el</code>, e depois definimos que o evento de click executa uma função que loga o <code>this</code>. Nesse caso, também o <code>this</code> se refere ao próprio elemento que disparou o evento, no caso <code>el</code>.
Até agora imagino que tá tudo de boa, eu acho.</p>
<h2><code>function</code>s criam escopo, e não preservam o <code>this</code> do contexto</h2>
<p>Voltemos ao exemplo do objeto, mas vamos criar mais um método:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">m</span><span class="o">:</span> <span class="nx">outerScope</span><span class="p">,</span>

    <span class="nx">n</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="kd">function</span> <span class="nx">inside</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="nx">inside</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>Aqui, adicionamos mais um método à <code>o</code>, <code>n</code>, que loga o <code>this</code> duas vezes: uma diretamente no método e outra dentro de uma função que está <em>dentro</em> desse método. Se você executar <code>o.n()</code>, sua reação pode ser das mais variadas: "whatta fuck" "Q" "BÉ ISSO, MAH" e por aí vai.</p>
<p>O primeiro <code>this</code> se refere ao objeto <code>o</code>, como anteriormente, porém sendo chamado dentro da função <code>inside</code> ele mostra <code>window</code>! Isso acontece porque, ao criar uma nova função com <code>function</code>, o <code>this</code> (e até <code>arguments</code>) não é trazido do contexto da função mais externa para o função interna, e então ele se refere ao próprio <code>window</code>.</p>
<p><img alt="mindblowing" src="https://media.giphy.com/media/OK27wINdQS5YQ/giphy.gif" title="mindblowing" /></p>
<p>Mas então, como diabos eu acessaria o <code>this</code> da função externa? Quando eu tiver definindo uma função construtora e seus metódos, como é que eu ia referenciar o <code>this</code>, que é o objeto criado?</p>
<h3>1/2: arrow function</h3>
<p>Se você é descolado(a) e quer usar as novas features da linguagem e dizer que tá por dentro, pode usar as queridinhas arrow functions. Mais do que uma forma curta de escrever funções anônimas (<code>() =&gt; console.log(this)</code>), as arrow functions fazem o contexto permanecer o mesmo para o <code>this</code>, ficando o código assim</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">m</span><span class="o">:</span> <span class="nx">outerScope</span><span class="p">,</span>

    <span class="nx">n</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="c1">// Tenho que autoexecutá-la já que é uma função anônima</span>
        <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">)();</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>e mostrando duas vezes o objeto <code>o</code>. Simples e elegante.</p>
<h2>2/2: "that" pra quem te quer</h2>
<p>Se você não quer usar arrow function, ou melhor, quando NÃO HAVIA ISSO NA LINGUAGEM, o que era feito era atribuir o valor de <code>this</code> a outra variável no escopo acima, geralmente com o nome "that" ou "self" e aí sim através dela estaria disponível no escopo mais interno. Ficaria assim:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">m</span><span class="o">:</span> <span class="nx">outerScope</span><span class="p">,</span>

    <span class="nx">n</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="c1">// TAH-DAH ;)</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">function</span> <span class="nx">inside</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">that</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="nx">inside</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<h2>Conclusão</h2>
<p>Acho que consegui cobrir os principais casos do <code>this</code> na invocação de funções. Se faltou alguma coisa (e faltou), comenta aí embaixo pra gente trocar uma ideia sobre :D
Pra um texto bem mais aprofundado e completo, recomendo demais a leitura do EXCELENTE <a href="https://github.com/getify/You-Dont-Know-JS/tree/master/this%20%26%20object%20prototypes">You Don't Know: <em>this</em> &amp; Object Prototypes JS</a>, especialmente os capitulos 1 e 2 tratam desse tema.</p>
<p>Durante muito tempo eu <em>só</em> usei jQuery nas minhas páginas, pelos motivos óbvios: mais rapidez no desenvolvimento, segurança ao fazer uma página que vai funcionar na maior quantidade de navegadores possível, biblioteca que faz de tudo um pouco, etc. E longe de mim condenar a lib, eu acho que o que merece atenção é a <em>atitude</em> dos desenvolvedores que a utilizam sem conhecer a linguagem em si, porque você acaba ficando viciado nela sem realmente entender como a liguagem funciona e não  sabe o que fazer quando você não tem ela à mão. Recomendo botar a mão na massa.</p>
            <div class="hr"></div>
            <a href="#" class="go-top">Ir para o topo</a>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "dunderlabs"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><footer class="footer">
    <p>&copy; __labs__ &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-72641866-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>
</body>
</html>